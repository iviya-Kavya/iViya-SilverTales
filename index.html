<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>iViya ‚Äî Silver Tales</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
:root{
  --bg:#070708;
  --panel:#0b1220;
  --muted:#9aa4b2;
  --silver:#bfc6ca;
  --accent:#e6e9eb;
  --glass: rgba(255,255,255,0.04);
  --glow: rgba(190,196,200,0.06);
  --whatsapp:#25D366;
}
*{box-sizing:border-box}
html { scroll-behavior:smooth; }
body {
  margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  background: linear-gradient(0deg,#050506 0%, #0b0b0d 100%);
  color:var(--accent);
  -webkit-font-smoothing:antialiased;
}

/* NAV */
nav {
  position:sticky; top:0; z-index:1200;
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 14px;
  backdrop-filter: blur(8px);
  background: rgba(6,6,7,0.55);
  border-bottom:1px solid rgba(255,255,255,0.03);
}

/* hamburger */
.menu-icon{ display:flex; flex-direction:column; gap:5px; width:26px; cursor:pointer; }
.menu-icon div{ height:3px; background:var(--silver); border-radius:3px; transition:all .28s cubic-bezier(.2,.9,.25,1); }
.menu-icon.active div:nth-child(1){ transform:rotate(45deg) translateY(6px); }
.menu-icon.active div:nth-child(2){ opacity:0; transform:scaleX(.2); }
.menu-icon.active div:nth-child(3){ transform:rotate(-45deg) translateY(-6px); }

/* logo */
.logo { text-align:center; line-height:1; user-select:none; flex:1; }
.logo .title { font-weight:700; font-size:18px; color:var(--accent); }
.logo .tag { font-size:11px; color:var(--muted); margin-top:2px; letter-spacing:0.8px; }

/* controls (icons on right) */
.controls { display:flex; gap:8px; align-items:center; justify-content:flex-end; width:auto; }
.icon-btn{ position:relative; background:transparent; border:none; color:var(--silver); font-size:18px; cursor:pointer; padding:8px; border-radius:8px; display:inline-flex; align-items:center; justify-content:center; }
.icon-btn .fa { font-size:18px; }
.icon-badge{ position:absolute; top:4px; right:6px; background:#ef4444; color:#fff; font-size:11px; padding:2px 6px; border-radius:999px; display:none; }

/* LEFT MENU (slide from left) */
.menu-left {
  position:fixed; top:64px; left:0; width:72%; max-width:320px;
  transform:translateX(-110%); transition:transform .35s cubic-bezier(.2,.9,.25,1);
  background: linear-gradient(180deg, rgba(18,18,19,0.98), rgba(12,12,13,0.98));
  box-shadow: 10px 20px 60px rgba(0,0,0,0.6);
  z-index:2000; color:var(--accent); padding:14px 8px; border-right:1px solid rgba(255,255,255,0.02);
  display:flex; flex-direction:column; gap:6px;
}
.menu-left.open { transform:translateX(0); }
.menu-left a {
  display:block; padding:12px 14px; color:var(--silver); text-decoration:none; border-radius:8px; font-weight:700;
  opacity:0; transform:translateX(-8px); animation: none;
}
.menu-left.open a { animation: menuFade .28s forwards; }
.menu-left.open a:nth-child(1){ animation-delay:0.03s }
.menu-left.open a:nth-child(2){ animation-delay:0.08s }
.menu-left.open a:nth-child(3){ animation-delay:0.13s }
@keyframes menuFade { to { opacity:1; transform:translateX(0); } }

/* overlay */
.overlay { position:fixed; inset:0; background:rgba(0,0,0,0.45); opacity:0; pointer-events:none; transition:opacity .25s; z-index:1300; }
.overlay.show{ opacity:1; pointer-events:auto; }

/* MAIN */
main { max-width:1200px; margin:24px auto 120px; padding:0 14px; }

/* HERO */
.header-hero { text-align:center; padding:36px 10px; }
.header-hero h1 { margin:0; font-size:28px; color:var(--accent); }
.header-hero p { margin:10px auto 0; color:var(--muted); max-width:760px; }

/* Collections header + tabs */
.collection-header { display:flex; flex-direction:column; gap:12px; align-items:center; margin-top:10px; }
.cat-tabs { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
.cat-btn {
  padding:8px 12px; border-radius:999px; background:transparent; border:1px solid rgba(255,255,255,0.02);
  color:var(--silver); cursor:pointer; font-weight:700; transition:all .18s;
}
.cat-btn.active { background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); box-shadow:0 6px 20px rgba(20,20,22,0.4); color:#fff; transform:translateY(-2px); }

/* Grid & card */
.grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:18px; margin-top:18px; }
.card {
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:12px; overflow:hidden; padding:10px; position:relative; box-shadow:0 8px 30px rgba(0,0,0,0.6);
  transition:transform .18s ease, box-shadow .18s ease;
}
.card:hover{ transform:translateY(-6px); box-shadow:0 18px 40px rgba(0,0,0,0.7); }
.card .imgwrap{ width:100%; height:220px; background:#08090a; display:flex; align-items:center; justify-content:center; overflow:hidden; border-radius:8px; }
.card img{ width:100%; height:100%; object-fit:contain; display:block; }
.card .info{ padding:10px 6px; display:flex; flex-direction:column; gap:8px; }
.card .name{ color:var(--accent); font-weight:700; }
.card .price{ color:var(--silver); font-weight:800; }
.card .desc{ color:var(--muted); font-size:13px; min-height:36px; }

/* heart */
.heart-btn{ position:absolute; top:12px; right:12px; width:40px;height:40px;border-radius:999px;background:rgba(255,255,255,0.03); color:var(--silver); border:none; cursor:pointer; display:flex; align-items:center; justify-content:center; }
.heart-btn.active{ background:rgba(239,68,68,0.12); color:#ff6b6b; transform:scale(1.05); }

/* add to cart */
.add-cart { margin-top:6px; background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--accent); padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700; }
.add-cart:hover{ background:var(--glow); color:#fff; transform:translateY(-2px); }

/* side panels */
.side-panel {
  position:fixed; top:0; right:0; height:100vh; width:380px; max-width:94vw;
  transform: translateX(110%); transition: transform .36s cubic-bezier(.2,.9,.25,1), opacity .28s; opacity:0;
  background:linear-gradient(180deg,var(--panel), #071018); color:var(--accent); z-index:1400; display:flex; flex-direction:column; border-left:1px solid rgba(255,255,255,0.02);
  box-shadow:-20px 0 60px rgba(0,0,0,0.6);
}
.side-panel.open{ transform:translateX(0); opacity:1; }
.panel-head{ padding:16px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(255,255,255,0.03); }
.panel-body{ padding:12px; overflow:auto; flex:1; }
.panel-item{ display:flex; gap:10px; align-items:center; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.02); }
.panel-item img{ width:64px; height:64px; object-fit:contain; border-radius:8px; background:#fff; padding:6px; }
.panel-meta .pn{ font-weight:700; color:#fff; }
.panel-meta .pm{ color:var(--muted); font-size:13px; }

/* sticky footer in panel */
.panel-footer{ padding:12px; border-top:1px solid rgba(255,255,255,0.03); display:flex; justify-content:space-between; align-items:center; position:sticky; bottom:0; background:linear-gradient(180deg, rgba(11,12,13,0.0), rgba(11,12,13,0.95)); gap:10px; }

/* checkout button bigger */
.checkout-btn { background:var(--whatsapp); color:#fff; border:none; padding:12px 14px; border-radius:10px; font-weight:800; font-size:16px; cursor:pointer; box-shadow:0 8px 30px rgba(37,211,102,0.12); }

/* detail slide-up */
.detail-wrap { position:fixed; left:0; right:0; bottom:0; height:100vh; z-index:1500; transform: translateY(110%); transition: transform .36s cubic-bezier(.2,.9,.25,1); background: linear-gradient(180deg,#050607 0%, #0b0b0d 100%); color:var(--accent); padding:14px; display:flex; flex-direction:column; }
.detail-wrap.open{ transform: translateY(0%); }
.detail-header{ display:flex; justify-content:space-between; align-items:center; padding:8px 6px; border-bottom:1px solid rgba(255,255,255,0.03); }
.detail-body{ display:flex; gap:18px; padding:12px; overflow:auto; flex:1; flex-wrap:wrap; align-items:flex-start; justify-content:center; }

/* gallery */
.detail-gallery{ flex:0 0 520px; max-width:520px; display:flex; flex-direction:column; gap:10px; align-items:center; }
.detail-main { width:100%; height:440px; background:#050607; display:flex; align-items:center; justify-content:center; overflow:hidden; border-radius:10px; }
.detail-main img{ width:100%; height:100%; object-fit:contain; }
.detail-thumbs{ display:flex; gap:8px; overflow:auto; padding-top:6px; }
.detail-thumbs img{ width:72px; height:72px; object-fit:contain; border-radius:8px; background:#fff; padding:6px; cursor:pointer; border:2px solid transparent; }
.detail-thumbs img.active{ border-color:var(--silver); }

/* detail info */
.detail-info{ flex:1; min-width:260px; max-width:720px; display:flex; flex-direction:column; gap:10px; }
.detail-title{ font-size:20px; font-weight:800; color:var(--accent); }
.detail-price{ font-weight:800; color:var(--silver); font-size:18px; }
.detail-desc{ color:var(--muted); line-height:1.6; }

/* responsive */
@media(max-width:900px){
  .detail-body{ flex-direction:column; align-items:center; }
  .detail-gallery{ width:100%; max-width:720px; }
  .detail-main{ height:320px; }
  .card .imgwrap{ height:180px; }
  .controls { width:auto; }
  nav { padding:10px 12px; }
  .menu-left { top:56px; }
}
@media(max-width:420px){
  .detail-main{ height:260px; }
  .side-panel{ width:100%; max-width:100vw; }
  .menu-left { width:82%; }
}
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="menu-icon" id="menuToggle" aria-label="Open menu" title="Menu">
    <div></div><div></div><div></div>
  </div>

  <div class="logo">
    <div class="title">iViya</div>
    <div class="tag">Silver Tales</div>
  </div>

  <div class="controls" aria-hidden="false">
    <!-- WhatsApp icon (opens chat) -->
    <button class="icon-btn" id="navWhatsApp" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></button>
    <!-- Contact icon -->
    <button class="icon-btn" id="navContact" title="Contact"><i class="fa-solid fa-phone"></i></button>
    <!-- Login -->
    <button class="icon-btn" id="navLogin" title="Login"><i class="fa-regular fa-user"></i></button>
    <!-- Signup -->
    <button class="icon-btn" id="navSignup" title="Sign up"><i class="fa-solid fa-user-plus"></i></button>

    <!-- wishlist & cart -->
    <button class="icon-btn" id="wishToggle" title="Wishlist"> <i class="fa-regular fa-heart"></i> <span class="icon-badge" id="wishBadge"></span></button>
    <button class="icon-btn" id="cartToggle" title="Cart"> <i class="fa-solid fa-bag-shopping"></i> <span class="icon-badge" id="cartBadge"></span></button>
  </div>
</nav>

<!-- LEFT MENU (only Home, About, Collections) -->
<nav class="menu-left" id="leftMenu" aria-hidden="true">
  <a href="#home">Home</a>
  <a href="#about">About</a>
  <a href="#collections">Collections</a>
</nav>

<!-- overlay -->
<div class="overlay" id="overlay"></div>

<!-- MAIN -->
<main>
  <header class="header-hero" id="home">
    <h1>iViya ‚Äî Silver Tales</h1>
    <p class="lead">Matte black ‚Äî silver highlights. Manage products from your Google Sheet (columns: name, price, sku, category, image_url, image_gallery).</p>
  </header>

  <section id="collections">
    <div class="collection-header">
      <h2 style="margin:0;color:var(--accent)">Collections</h2>
      <div class="cat-tabs" id="catTabs"></div>
    </div>

    <div class="grid" id="grid"></div>
  </section>

  <section id="about">
    <h2 style="color:var(--accent)">About</h2>
    <p style="color:var(--muted);max-width:720px;margin:8px auto 40px">iViya blends traditional craftsmanship with modern design. Use the `category` column (e.g., rings, earrings, anklets, chains, pendants, pendant sets, bracelets, bangles) and `image_gallery` comma-separated URLs for multi-image products.</p>
  </section>

  <section id="contact">
    <h2 style="color:var(--accent)">Contact</h2>
    <p style="color:var(--muted)">Email: contact@iviyasilver.com</p>
  </section>
</main>

<!-- WISHLIST PANEL -->
<aside class="side-panel" id="wishPanel" aria-hidden="true">
  <div class="panel-head">
    <h3>Wishlist</h3>
    <button class="icon-btn" id="closeWish" aria-label="Close">‚úï</button>
  </div>
  <div class="panel-body" id="wishBody"><p style="color:var(--muted)">No items yet.</p></div>
  <div class="panel-footer" id="wishFooter" style="display:none">
    <div style="color:var(--muted)">Items</div>
    <div><button class="checkout-btn" id="wishCheckout" style="background:#2a2a2a;border:none;color:var(--silver);padding:10px;border-radius:8px">Contact</button></div>
  </div>
</aside>

<!-- CART PANEL -->
<aside class="side-panel" id="cartPanel" aria-hidden="true">
  <div class="panel-head">
    <h3>Cart</h3>
    <button class="icon-btn" id="closeCart" aria-label="Close">‚úï</button>
  </div>
  <div class="panel-body" id="cartBody"><p style="color:var(--muted)">Your cart is empty.</p></div>
  <div class="panel-footer" id="cartFooter" style="display:none">
    <div class="total" id="cartTotal" style="font-weight:800;color:var(--silver);font-size:18px">‚Çπ0</div>
    <div style="display:flex;gap:8px">
      <button class="checkout-btn" id="checkoutBtn"><i class="fa-brands fa-whatsapp" style="margin-right:8px"></i> Checkout</button>
    </div>
  </div>
</aside>

<!-- PRODUCT DETAIL (slide-up) -->
<div class="detail-wrap" id="detailWrap" aria-hidden="true">
  <div class="detail-header">
    <div style="display:flex;gap:10px;align-items:center">
      <button class="icon-btn" id="detailBack">‚Üê</button>
      <div id="detailTitle" style="font-weight:800;color:var(--accent)"></div>
    </div>
    <div id="detailActions" style="display:flex;gap:8px;align-items:center">
      <button class="icon-btn" id="detailWish">‚ô°</button>
      <button class="add-cart" id="detailAdd">Add to cart</button>
    </div>
  </div>

  <div class="detail-body">
    <div class="detail-gallery">
      <div class="detail-main"><img id="detailMainImg" src="" alt=""></div>
      <div class="detail-thumbs" id="detailThumbs"></div>
    </div>

    <div class="detail-info">
      <div id="detailName" class="detail-title"></div>
      <div id="detailPrice" class="detail-price"></div>
      <div id="detailDesc" class="detail-desc"></div>
      <div class="detail-actions">
        <div style="display:flex;gap:12px;align-items:center">
          <button class="add-cart" id="detailAddCart">Add to cart</button>
          <div style="color:var(--muted)">Qty in cart: <strong id="detailQty">0</strong></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* CONFIG */
const SHEET_URL = 'https://opensheet.elk.sh/1-ZrGnfPbTtmStHS8kWvQUHt7pnVMUjEb8TK7iloYoBs/Sheet1';
const WHATSAPP_NUMBER = '919876543210'; // <<< replace with your number (no +) e.g. 919876543210
const LS_WISH = 'iv_wishlist';
const LS_CART = 'iv_cart';

/* HELPERS */
const $ = id => document.getElementById(id);
function fmtINR(n){ return new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:0}).format(Number(n||0)); }
function uidFor(p){ return (p.sku || p.id || (p.name||p.title) || Math.random().toString(36).slice(2,9)).toString(); }

/* STORAGE */
function loadWishlist(){ try{return JSON.parse(localStorage.getItem(LS_WISH)||'[]')}catch(e){return[]}}
function saveWishlist(v){ localStorage.setItem(LS_WISH, JSON.stringify(v)); updateBadges(); if (wishPanel.classList.contains('open')) populateWishPanel(); }
function loadCart(){ try{return JSON.parse(localStorage.getItem(LS_CART)||'{}')}catch(e){return{}}}
function saveCart(v){ localStorage.setItem(LS_CART, JSON.stringify(v)); updateBadges(); if (cartPanel.classList.contains('open')) populateCartPanel(); }

/* UI refs */
const menuToggle = $('menuToggle');
const leftMenu = document.querySelector('.menu-left');
const overlay = $('overlay');
const wishToggle = $('wishToggle');
const cartToggle = $('cartToggle');
const wishPanel = $('wishPanel');
const cartPanel = $('cartPanel');
const wishBadge = $('wishBadge');
const cartBadge = $('cartBadge');
const grid = $('grid');
const catTabs = $('catTabs');
const detailWrap = $('detailWrap');
const detailThumbs = $('detailThumbs');
const detailMainImg = $('detailMainImg');
const detailTitle = $('detailTitle');
const detailName = $('detailName');
const detailPrice = $('detailPrice');
const detailDesc = $('detailDesc');
const detailQty = $('detailQty');
const checkoutBtn = $('checkoutBtn');

/* Data */
let PRODUCTS = {};
let CURRENT_CAT = 'All';
let CURRENT_DETAIL_ID = null;

/* MENU toggle (left) */
menuToggle.addEventListener('click', ()=>{
  menuToggle.classList.toggle('active');
  leftMenu.classList.toggle('open');
  if(leftMenu.classList.contains('open')) { overlay.classList.add('show'); } else { overlay.classList.remove('show'); }
});

/* nav icons */
$('navWhatsApp').addEventListener('click', ()=> window.open(`https://wa.me/${WHATSAPP_NUMBER}`, '_blank'));
$('navContact').addEventListener('click', ()=> window.location.href = 'mailto:contact@iviyasilver.com');
$('navLogin').addEventListener('click', ()=> alert('Login placeholder ‚Äî implement auth flow.'));
$('navSignup').addEventListener('click', ()=> alert('Sign up placeholder ‚Äî implement sign-up flow.'));

/* overlay close everything */
overlay.addEventListener('click', ()=> {
  leftMenu.classList.remove('open'); menuToggle.classList.remove('active');
  closePanels(); closeDetail(); overlay.classList.remove('show');
});

/* load products from sheet */
async function loadProducts(){
  try{
    const res = await fetch(SHEET_URL);
    const data = await res.json();
    PRODUCTS = {};
    const desired = ['rings','earrings','anklets','chains','pendants','pendant sets','bracelets','bangles'];
    data.forEach((p,idx)=>{
      const id = uidFor(p);
      // gallery handling
      let gallery = [];
      if(p.image_gallery && String(p.image_gallery).trim()){
        gallery = String(p.image_gallery).split(',').map(s=>s.trim()).filter(Boolean);
      }
      if(!gallery.length && p.image_url) gallery = [p.image_url];
      if(!gallery.length && p.image) gallery = [p.image];
      const cat = (p.category || p.Category || '').toString().trim().toLowerCase();
      const name = p.name || p.title || ('Product ' + (idx+1));
      const price = Number(p.price) || 0;
      const desc = p.description || p.desc || '';
      const sku = p.sku || p.SKU || '';
      PRODUCTS[id] = { id, name, price, desc, gallery, raw:p, category:cat, sku };
    });

    // build category tabs (All + desired that exist)
    const cats = ['All', ...desired.filter(c => Object.values(PRODUCTS).some(p=>p.category===c))];
    renderCategoryTabs(cats);
    renderGrid();
    updateBadges();
  }catch(err){
    console.error('Failed to load sheet', err);
    grid.innerHTML = '<p style="color:#999">Failed to load products.</p>';
  }
}
loadProducts();

/* category tabs */
function renderCategoryTabs(list){
  catTabs.innerHTML = '';
  if(list.length===1){
    const found = new Set(Object.values(PRODUCTS).map(p=>p.category).filter(Boolean));
    list = ['All', ...Array.from(found)];
  }
  list.forEach((c,i)=>{
    const btn = document.createElement('button');
    btn.className = 'cat-btn' + (i===0 ? ' active' : '');
    btn.textContent = c[0].toUpperCase() + c.slice(1);
    btn.dataset.cat = c.toLowerCase();
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.cat-btn').forEach(x=>x.classList.remove('active'));
      btn.classList.add('active');
      CURRENT_CAT = c;
      renderGrid();
      window.scrollTo({top: document.querySelector('#collections').offsetTop - 80, behavior:'smooth'});
    });
    catTabs.appendChild(btn);
  });
}

/* render product grid filtered by CURRENT_CAT */
function renderGrid(){
  grid.innerHTML = '';
  const items = Object.values(PRODUCTS).filter(p=>{
    if(CURRENT_CAT === 'All') return true;
    return (p.category || '') === CURRENT_CAT.toLowerCase();
  });

  if(!items.length){
    grid.innerHTML = `<p style="color:var(--muted); grid-column:1/-1; text-align:center">No products in this category.</p>`;
    return;
  }

  items.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'card';
    const img = p.gallery && p.gallery.length ? p.gallery[0] : 'https://via.placeholder.com/400x300?text=No+Image';
    card.innerHTML = `
      <button class="heart-btn" data-id="${p.id}" title="Wishlist">‚ô°</button>
      <div class="imgwrap"><img src="${img}" alt="${p.name}" loading="lazy"></div>
      <div class="info">
        <div class="name">${p.name}</div>
        <div class="price">${fmtINR(p.price)}</div>
        <div class="desc">${p.desc}</div>
        <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
          <button class="add-cart" data-id="${p.id}">Add to cart</button>
        </div>
      </div>
    `;
    card.dataset.item = JSON.stringify(p);
    grid.appendChild(card);

    // heart toggle
    const heart = card.querySelector('.heart-btn');
    function refreshHeart(){
      const list = loadWishlist();
      const found = list.find(x=> x.id === p.id);
      heart.classList.toggle('active', !!found);
      heart.textContent = found ? '‚ù§Ô∏è' : '‚ô°';
    }
    refreshHeart();
    heart.addEventListener('click', (ev)=>{
      ev.stopPropagation();
      let list = loadWishlist();
      const found = list.find(x=> x.id === p.id);
      if(found) list = list.filter(x=> x.id !== p.id);
      else list.push({ id:p.id, name:p.name, price:p.price, img:p.gallery[0]||'', sku:p.sku||p.SKU||'' });
      saveWishlist(list);
      refreshHeart();
    });

    // add to cart
    const addBtn = card.querySelector('.add-cart');
    addBtn.addEventListener('click', (ev)=>{
      ev.stopPropagation();
      const cart = loadCart();
      if(!cart[p.id]) cart[p.id] = { id:p.id, name:p.name, price:p.price, img:p.gallery[0]||'', qty:0, sku:p.sku||'' };
      cart[p.id].qty = (cart[p.id].qty || 0) + 1;
      saveCart(cart);
      // small visual feedback
      addBtn.textContent = 'Added';
      setTimeout(()=> addBtn.textContent = 'Add to cart', 900);
    });

    // open detail
    card.addEventListener('click', ()=> showProductDetail(p.id));
  });
}

/* badges & panels */
function updateBadges(){
  const wish = loadWishlist();
  const cart = loadCart();
  wishBadge.style.display = wish.length ? 'inline-block' : 'none';
  wishBadge.textContent = wish.length;
  const qty = Object.values(cart).reduce((s,i)=> s + (i.qty||0), 0);
  cartBadge.style.display = qty ? 'inline-block' : 'none';
  cartBadge.textContent = qty;
}

/* open/close panels */
function closePanels(){
  wishPanel.classList.remove('open');
  cartPanel.classList.remove('open');
  overlay.classList.remove('show');
  wishPanel.setAttribute('aria-hidden','true');
  cartPanel.setAttribute('aria-hidden','true');
}
function openWish(){
  populateWishPanel();
  wishPanel.classList.add('open');
  overlay.classList.add('show');
}
function openCart(){
  populateCartPanel();
  cartPanel.classList.add('open');
  overlay.classList.add('show');
}

/* toggle clicks */
$('wishToggle').addEventListener('click', ()=>{
  if(wishPanel.classList.contains('open')) closePanels();
  else { closeDetail(); leftMenu.classList.remove('open'); menuToggle.classList.remove('active'); openWish(); }
});
$('cartToggle').addEventListener('click', ()=>{
  if(cartPanel.classList.contains('open')) closePanels();
  else { closeDetail(); leftMenu.classList.remove('open'); menuToggle.classList.remove('active'); openCart(); }
});
$('closeWish').addEventListener('click', closePanels);
$('closeCart').addEventListener('click', closePanels);

/* populate wishlist panel */
function populateWishPanel(){
  const container = $('wishBody');
  const list = loadWishlist();
  container.innerHTML = '';
  if(!list.length){ container.innerHTML = '<p style="color:var(--muted)">Your wishlist is empty.</p>'; $('wishFooter').style.display='none'; return; }
  $('wishFooter').style.display='flex';
  list.forEach(it=>{
    const row = document.createElement('div'); row.className='panel-item';
    row.innerHTML = `<img src="${it.img}" alt="${it.name}"><div class="panel-meta"><div class="pn">${it.name}</div><div class="pm">${fmtINR(it.price)} ‚Ä¢ SKU: ${it.sku||it.SKU||''}</div><div style="margin-top:8px"><button class="remove-btn" data-id="${it.id}">Remove</button></div></div>`;
    container.appendChild(row);
  });
  container.querySelectorAll('.remove-btn').forEach(b=> b.addEventListener('click', ()=>{
    const id = b.dataset.id; let list = loadWishlist(); list = list.filter(x=> x.id !== id); saveWishlist(list); populateWishPanel();
  }));
}

/* populate cart panel */
function populateCartPanel(){
  const container = $('cartBody');
  const cart = loadCart();
  container.innerHTML = '';
  const ids = Object.keys(cart);
  if(!ids.length){ container.innerHTML = '<p style="color:var(--muted)">Your cart is empty.</p>'; $('cartFooter').style.display='none'; $('cartTotal').textContent = fmtINR(0); return; }
  $('cartFooter').style.display='flex';
  let total = 0;
  ids.forEach(id=>{
    const it = cart[id]; total += (it.price||0)*(it.qty||0);
    const row = document.createElement('div'); row.className='panel-item';
    row.innerHTML = `<img src="${it.img}" alt="${it.name}"><div class="panel-meta"><div class="pn">${it.name}</div><div class="pm">${fmtINR(it.price)} ‚Ä¢ SKU: ${it.sku||''} ‚Ä¢ Qty: <strong id="q-${id}">${it.qty}</strong></div><div class="qty-controls" style="margin-top:8px"><button class="dec" data-id="${id}">‚àí</button><button class="inc" data-id="${id}">+</button><button class="remove-btn" data-id="${id}" style="margin-left:12px">Remove</button></div></div>`;
    container.appendChild(row);
  });
  $('cartTotal').textContent = fmtINR(total);

  container.querySelectorAll('.inc').forEach(b=> b.addEventListener('click', ()=>{
    const id = b.dataset.id; const cartObj = loadCart(); cartObj[id].qty = (cartObj[id].qty||0)+1; saveCart(cartObj); populateCartPanel();
  }));
  container.querySelectorAll('.dec').forEach(b=> b.addEventListener('click', ()=>{
    const id = b.dataset.id; const cartObj = loadCart(); cartObj[id].qty = Math.max(0,(cartObj[id].qty||0)-1); if(cartObj[id].qty===0) delete cartObj[id]; saveCart(cartObj); populateCartPanel();
  }));
  container.querySelectorAll('.remove-btn').forEach(b=> b.addEventListener('click', ()=>{
    const id = b.dataset.id; const cartObj = loadCart(); delete cartObj[id]; saveCart(cartObj); populateCartPanel();
  }));
}

/* detail view (slide-up) */
function showProductDetail(id){
  const p = PRODUCTS[id]; if(!p) return;
  CURRENT_DETAIL_ID = id;
  detailTitle.textContent = p.name;
  detailName.textContent = p.name;
  detailPrice.textContent = fmtINR(p.price);
  detailDesc.textContent = p.desc;

  const gallery = p.gallery && p.gallery.length ? p.gallery : ['https://via.placeholder.com/800x600?text=No+Image'];
  detailThumbs.innerHTML = '';
  gallery.forEach((src,i)=>{
    const img = document.createElement('img'); img.src = src; img.alt = p.name + ' ' + (i+1);
    if(i===0) img.classList.add('active');
    img.addEventListener('click', ()=> {
      detailMainImg.src = src; detailThumbs.querySelectorAll('img').forEach(x=>x.classList.remove('active')); img.classList.add('active');
    });
    detailThumbs.appendChild(img);
  });
  detailMainImg.src = gallery[0];
  const cartObj = loadCart(); detailQty.textContent = cartObj[id] ? cartObj[id].qty : 0;
  refreshDetailWish();
  detailWrap.classList.add('open'); overlay.classList.add('show');
  closePanels(); leftMenu.classList.remove('open'); menuToggle.classList.remove('active');
}
$('detailBack').addEventListener('click', closeDetail = ()=> { detailWrap.classList.remove('open'); overlay.classList.remove('show'); CURRENT_DETAIL_ID = null; });

function refreshDetailWish(){
  const wish = loadWishlist(); const exists = wish.find(x=> x.id === CURRENT_DETAIL_ID);
  $('detailWish').textContent = exists ? '‚ù§Ô∏è' : '‚ô°';
}

/* detail add/wish */
$('detailWish').addEventListener('click', ()=>{
  if(!CURRENT_DETAIL_ID) return;
  let list = loadWishlist(); const found = list.find(x=> x.id === CURRENT_DETAIL_ID);
  if(found) list = list.filter(x=> x.id !== CURRENT_DETAIL_ID);
  else { const p = PRODUCTS[CURRENT_DETAIL_ID]; list.push({ id:p.id, name:p.name, price:p.price, img:p.gallery[0]||'', sku:p.sku||'' }); }
  saveWishlist(list); refreshDetailWish();
});
$('detailAdd').addEventListener('click', ()=>{
  if(!CURRENT_DETAIL_ID) return;
  const cart = loadCart(); const p = PRODUCTS[CURRENT_DETAIL_ID];
  if(!cart[p.id]) cart[p.id] = { id:p.id, name:p.name, price:p.price, img:p.gallery[0]||'', qty:0, sku:p.sku||'' };
  cart[p.id].qty = (cart[p.id].qty || 0) + 1;
  saveCart(cart); $('detailQty').textContent = cart[p.id].qty;
});
$('detailAddCart').addEventListener('click', ()=> $('detailAdd').click());

/* WhatsApp checkout with thumbnails & SKUs */
$('checkoutBtn').addEventListener('click', checkout);
function checkout(){
  const cart = loadCart(); const ids = Object.keys(cart);
  if(!ids.length) return alert('Cart is empty');
  const lines = []; let total = 0;
  ids.forEach((id, idx)=>{
    const it = cart[id];
    const price = Number(it.price) || 0;
    const lineTotal = price * (it.qty || 0);
    total += lineTotal;
    const thumb = it.img || '';
    lines.push(`${idx+1}. ${it.name} (SKU: ${it.sku || ''})\n‚Çπ${price.toLocaleString()} √ó ${it.qty}\n${thumb}`);
  });
  let message = `üíé iViya ‚Äì Silver Tales Order\n\nüõçÔ∏è Cart Items:\n${lines.join('\n')}\n\nüí∞ Total: ‚Çπ${total.toLocaleString()}\n\nüìç Please confirm your delivery address and preferred payment method.`;
  const encoded = encodeURIComponent(message);
  window.open(`https://wa.me/919080816049?text=${encoded}`, '_blank');
}

/* wishlist checkout placeholder */
$('wishCheckout').addEventListener('click', ()=>{
  const w = loadWishlist(); if(!w.length) return alert('Wishlist is empty'); alert('Wishlist flow placeholder ‚Äî implement move-to-cart or contact.');
});

/* storage helpers */
function loadWishlist(){ try{ return JSON.parse(localStorage.getItem(LS_WISH)||'[]') }catch(e){ return []; } }
function saveWishlist(list){ localStorage.setItem(LS_WISH, JSON.stringify(list)); updateBadges(); if (wishPanel.classList.contains('open')) populateWishPanel(); }
function loadCart(){ try{ return JSON.parse(localStorage.getItem(LS_CART)||'{}') }catch(e){ return {}; } }
function saveCart(obj){ localStorage.setItem(LS_CART, JSON.stringify(obj)); updateBadges(); if (cartPanel.classList.contains('open')) populateCartPanel(); }

/* badge update */
function updateBadges(){ const w = loadWishlist(); const c = loadCart(); wishBadge.style.display = w.length ? 'inline-block' : 'none'; wishBadge.textContent = w.length; const qty = Object.values(c).reduce((s,i)=> s + (i.qty||0), 0); cartBadge.style.display = qty ? 'inline-block' : 'none'; cartBadge.textContent = qty; }

/* initial update */
updateBadges();

/* keep panels in sync if storage changes in other tabs */
window.addEventListener('storage', ()=> { updateBadges(); renderGrid(); });

</script>
</body>
</html>
